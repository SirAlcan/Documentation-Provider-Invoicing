<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Schema Documentation Builder</title>
    <!-- External Libraries for Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8fafc;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px;
        }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 24px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background-color: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
        }

        .tab {
            padding: 16px 24px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: #64748b;
            transition: all 0.2s;
        }

        .tab:hover {
            color: #1e293b;
            background-color: #f1f5f9;
        }

        .tab.active {
            color: #4f46e5;
            border-bottom-color: #4f46e5;
            background-color: white;
        }

        .tab-content {
            padding: 24px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            background-color: #f8fafc;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .form-section h4 {
            font-weight: 600;
            margin-bottom: 12px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 12px;
        }

        .input, .select {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .input:focus, .select:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #4f46e5;
            color: white;
        }

        .btn-primary:hover {
            background-color: #4338ca;
        }

        .btn-success {
            background-color: #059669;
            color: white;
        }

        .btn-success:hover {
            background-color: #047857;
        }

        .btn-danger {
            background-color: #dc2626;
            color: white;
        }

        .btn-danger:hover {
            background-color: #b91c1c;
        }

        .btn-warning {
            background-color: #d97706;
            color: white;
        }

        .btn-warning:hover {
            background-color: #b45309;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .table-container {
            overflow-x: auto;
            margin-bottom: 24px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #d1d5db;
        }

        .table th {
            background-color: #1f2937;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
        }

        .table tr:hover {
            background-color: #f9fafb;
        }

        .badge {
            padding: 4px 8px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge-green {
            background-color: #dcfce7;
            color: #166534;
        }

        .badge-yellow {
            background-color: #fef3c7;
            color: #92400e;
        }

        .badge-orange {
            background-color: #fed7aa;
            color: #c2410c;
        }

        .code {
            background-color: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }

        .json-area {
            width: 100%;
            height: 400px;
            padding: 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }

        .json-output {
            height: 400px;
            padding: 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background-color: #f9fafb;
            overflow: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .toolbar-group {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-input {
            max-width: 300px;
            margin-bottom: 16px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
        }

        .field-code {
            font-family: 'Courier New', monospace;
            color: #2563eb;
        }

        .mydata-code {
            font-family: 'Courier New', monospace;
            color: #7c3aed;
        }

        .example-code {
            font-family: 'Courier New', monospace;
            color: #059669;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .icon {
            width: 16px;
            height: 16px;
        }

        .hidden {
            display: none !important;
        }

        .edit-row input, .edit-row select {
            width: 100%;
            padding: 4px 8px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <!-- Header -->
            <div class="header">
                <h1>Dynamic JSON Schema Documentation Builder</h1>
                <p>ŒîŒ∑ŒºŒπŒøœçœÅŒ≥Œ∑œÉŒµ schema documentation Œ∫Œ±Œπ automatic JSON comments</p>
            </div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('builder')">
                    üìã Schema Builder
                </button>
                <button class="tab" onclick="switchTab('processor')">
                    üíª JSON Processor
                </button>
                <button class="tab" onclick="switchTab('preview')">
                    üìÑ Documentation
                </button>
            </div>

            <!-- Schema Builder Tab -->
            <div id="builder" class="tab-content active">
                <div class="toolbar">
                    <h3>Schema Documentation Builder</h3>
                    <div class="toolbar-group">
                        <button class="btn btn-primary" onclick="exportSchema()">
                            üíæ Export Schema
                        </button>
                    </div>
                </div>

                <input type="text" id="searchInput" class="input search-input" placeholder="ŒëŒΩŒ±Œ∂ŒÆœÑŒ∑œÉŒ∑ fields..." oninput="filterFields()">

                <!-- Add New Field Form -->
                <div class="form-section">
                    <h4>Œ†œÅŒøœÉŒ∏ŒÆŒ∫Œ∑ ŒΩŒ≠ŒøœÖ field</h4>
                    <div class="form-grid">
                        <input type="text" id="newGroup" class="input" placeholder="Group">
                        <input type="text" id="newField" class="input" placeholder="JSON Field Name">
                        <select id="newMandatory" class="select">
                            <option value="YES">‚úÖ Mandatory</option>
                            <option value="NO">üü° Optional</option>
                            <option value="SPECIAL">‚ö†Ô∏è Special</option>
                        </select>
                        <select id="newType" class="select">
                            <option value="string">string</option>
                            <option value="number">number</option>
                            <option value="boolean">boolean</option>
                            <option value="object">object</option>
                            <option value="array">array</option>
                        </select>
                    </div>
                    <div class="form-grid">
                        <input type="text" id="newLength" class="input" placeholder="Length">
                        <input type="text" id="newMydata" class="input" placeholder="MyData Code">
                        <input type="text" id="newUbl" class="input" placeholder="UBL Code">
                        <input type="text" id="newDescription" class="input" placeholder="Greek|English Description">
                        <input type="text" id="newExamples" class="input" placeholder="Example value">
                    </div>
                    <button class="btn btn-success" onclick="addNewField()">
                        ‚ûï Œ†œÅŒøœÉŒ∏ŒÆŒ∫Œ∑ Field
                    </button>
                </div>

                <!-- Fields Table -->
                <div class="table-container">
                    <table class="table" id="fieldsTable">
                        <thead>
                            <tr>
                                <th>Group</th>
                                <th>JSON Field</th>
                                <th>Level</th>
                                <th>Mandatory</th>
                                <th>Type</th>
                                <th>Length</th>
                                <th>MyData</th>
                                <th>UBL</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fieldsTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- JSON Processor Tab -->
            <div id="processor" class="tab-content">
                <div class="toolbar">
                    <h3>JSON Comment Generator</h3>
                    <div class="toolbar-group">
                        <button class="btn btn-primary" onclick="loadSampleData()">
                            üóÉÔ∏è Load Sample
                        </button>
                        <button class="btn btn-primary" onclick="copyOutput()">
                            üìã Copy Output
                        </button>
                        <button class="btn btn-success" onclick="downloadCommentedJson()">
                            üíæ Download JSONC
                        </button>
                    </div>
                </div>

                <div class="grid-2">
                    <div>
                        <h4 style="margin-bottom: 16px;">Input JSON</h4>
                        <textarea id="inputJson" class="json-area" placeholder="Paste your JSON here..." oninput="generateComments()"></textarea>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 16px;">Output JSONC (with Comments)</h4>
                        <div id="outputJsonc" class="json-output"></div>
                    </div>
                </div>
            </div>

            <!-- Documentation Preview Tab -->
            <div id="preview" class="tab-content">
                <div class="toolbar">
                    <h3>Schema Documentation Preview</h3>
                    <div class="toolbar-group">
                        <button class="btn btn-warning" onclick="exportToPDF()">
                            üìÑ Export PDF
                        </button>
                        <button class="btn btn-success" onclick="exportToExcel()">
                            üìä Export Excel
                        </button>
                    </div>
                </div>
                <div id="documentationContent"></div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let schemaFields = [
            // Root Invoice Fields
            { id: 1, group: 'invoice', field: 'isDelayedCode', level: 'root', mandatory: 'YES', type: 'number', length: '1', mydata: '', ubl: '', description: 'ŒëŒ¥œÖŒΩŒ±ŒºŒØŒ± ŒïœÄŒπŒ∫ŒøŒπŒΩœâŒΩŒØŒ±œÇ Œ†Œ±œÅœåœáŒøœÖ ŒÆ ŒëŒ¥œÖŒΩŒ±ŒºŒØŒ± ŒîŒπŒ±Œ≤ŒØŒ≤Œ±œÉŒ∑œÇ ŒîŒµŒ¥ŒøŒºŒ≠ŒΩœâŒΩ Œ±œÄœå ERP', examples: '0' },
            { id: 2, group: 'invoice', field: 'series', level: 'root', mandatory: 'YES', type: 'string', length: '50', mydata: 'BT-31', ubl: '', description: 'Œ£ŒµŒπœÅŒ¨ œÄŒ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Series', examples: '"Œö"' },
            { id: 3, group: 'invoice', field: 'number', level: 'root', mandatory: 'YES', type: 'string', length: '100', mydata: 'BT-32', ubl: '', description: 'ŒëœÅŒπŒ∏ŒºœåœÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Number', examples: '"000002"' },
            { id: 4, group: 'invoice', field: 'dateIssued', level: 'root', mandatory: 'YES', type: 'string', length: '19', mydata: 'BT-2', ubl: '', description: 'ŒóŒº. ŒàŒ∫Œ¥ŒøœÉŒ∑œÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Date Invoice Issuance', examples: '"2024-07-17T23:27:23"' },
            { id: 5, group: 'invoice', field: 'invoiceTypeCode', level: 'root', mandatory: 'YES', type: 'string', length: '10', mydata: 'BT-3', ubl: '', description: 'ŒïŒØŒ¥ŒøœÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Type', examples: '"1.1"' },
            { id: 6, group: 'invoice', field: 'invoiceType', level: 'root', mandatory: 'YES', type: 'string', length: '200', mydata: '', ubl: '', description: 'Œ†ŒµœÅŒπŒ≥œÅŒ±œÜŒÆ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Description', examples: '"Œ§ŒπŒºŒøŒªœåŒ≥ŒπŒø Œ†œéŒªŒ∑œÉŒ∑œÇ"' },
            { id: 7, group: 'invoice', field: 'documentTypeCode', level: 'root', mandatory: 'YES', type: 'string', length: '20', mydata: '', ubl: '', description: 'Œ§œçœÄŒøœÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Type of Invoice', examples: '"INVOICE"' },
            { id: 8, group: 'invoice', field: 'currency', level: 'root', mandatory: 'NO', type: 'string', length: '50', mydata: 'BT-5', ubl: '', description: 'Œ†ŒµœÅŒπŒ≥œÅŒ±œÜŒÆ ŒΩŒøŒºŒØœÉŒºŒ±œÑŒøœÇ|Currency description', examples: '"Euro"' },
            { id: 9, group: 'invoice', field: 'relativeDocuments', level: 'root', mandatory: 'NO', type: 'array', length: '', mydata: '', ubl: '', description: 'Œ£œáŒµœÑŒπŒ∫Œ¨ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œ¨|Related Documents', examples: '["K-00001", "ŒîŒë-00002"]' },
            { id: 10, group: 'invoice', field: 'correlatedInvoices', level: 'root', mandatory: 'SPECIAL', type: 'array', length: '', mydata: '', ubl: '', description: 'Œ£œÖœÉœáŒµœÑŒπŒ∂œåŒºŒµŒΩŒ± Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œ¨|Associated invoices', examples: '[400001929420636]' },
            { id: 11, group: 'invoice', field: 'multipleConnectedMarks', level: 'root', mandatory: 'SPECIAL', type: 'array', length: '', mydata: '', ubl: '', description: 'Œ£œÖœÉœáŒµœÑŒπŒ∂œåŒºŒµŒΩŒ± Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œ¨ 8.4, 8.5, 8.7, 9.3|Relation to Invoice 8.4, 8.5, 8.7, 9.3', examples: '[400001929420636, 400001929420587]' },
            { id: 12, group: 'invoice', field: 'gsisRelatedInvoices', level: 'root', mandatory: 'SPECIAL', type: 'string', length: '100', mydata: '', ubl: '', description: 'B2G Œ£œÖœÉœáŒµœÑŒπŒ∂œåŒºŒµŒΩŒ± Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œ¨ 5.1|B2G Related Invoice 5.1', examples: '""' },
            { id: 13, group: 'invoice', field: 'dispatchAdvice', level: 'root', mandatory: 'SPECIAL', type: 'string', length: '50', mydata: '', ubl: '', description: 'ŒîŒµŒªœÑŒØŒø ŒëœÄŒøœÉœÑŒøŒªŒÆœÇ|Dispatch Advice', examples: '"ŒîŒë-00001"' },
            { id: 14, group: 'invoice', field: 'selfPricing', level: 'root', mandatory: 'SPECIAL', type: 'boolean', length: '', mydata: '', ubl: '', description: 'ŒàŒΩŒ¥ŒµŒπŒæŒ∑ ŒëœÖœÑŒøœÑŒπŒºŒøŒªœåŒ≥Œ∑œÉŒ∑œÇ|Self Pricing Indication', examples: 'false' },
            { id: 15, group: 'invoice', field: 'isDeliveryNote', level: 'root', mandatory: 'SPECIAL', type: 'boolean', length: '', mydata: '', ubl: '', description: 'ŒàŒΩŒ¥ŒµŒπŒæŒ∑ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç ŒîŒπŒ±Œ∫ŒπŒΩŒπœÉŒ∑œÇ|Delivery Note Indication', examples: 'false' },
            { id: 16, group: 'invoice', field: 'isFuelInvoice', level: 'root', mandatory: 'SPECIAL', type: 'boolean', length: '', mydata: '', ubl: '', description: 'Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫œå Œ∫Œ±œÖœÉŒØŒºœâŒΩ|invoice fuel (indication)', examples: 'false' },
            { id: 17, group: 'invoice', field: 'vatPaymentSuspension', level: 'root', mandatory: 'SPECIAL', type: 'boolean', length: '', mydata: '', ubl: '', description: 'ŒëŒΩŒ±œÉœÑŒøŒªŒÆ ŒöŒ±œÑŒ±Œ≤ŒøŒªŒÆœÇ Œ¶Œ†Œë|Suspension of VAT Payment', examples: 'false' },
            { id: 18, group: 'invoice', field: 'specialInvoiceCategory', level: 'root', mandatory: 'SPECIAL', type: 'number', length: '2', mydata: '', ubl: '', description: 'ŒïŒπŒ¥ŒπŒ∫ŒÆ ŒöŒ±œÑŒ∑Œ≥ŒøœÅŒØŒ± Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Special Invoice Category', examples: '0' },
            { id: 19, group: 'invoice', field: 'providerSignatureIdentifier', level: 'root', mandatory: 'SPECIAL', type: 'string', length: '100', mydata: '', ubl: '', description: 'Identifier provided in the signPos', examples: '""' },
            
            // Order Fields
            { id: 20, group: 'order', field: 'orderSeries', level: 'root', mandatory: 'NO', type: 'string', length: '50', mydata: '', ubl: 'BT-13', description: 'Œ£ŒµŒπœÅŒ¨ Œ†Œ±œÅŒ±Œ≥Œ≥ŒµŒªŒØŒ±œÇ|Order Series', examples: '"A"' },
            { id: 21, group: 'order', field: 'orderNumber', level: 'root', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: 'BT-13', description: 'Order fiscal number', examples: '"5094746384, 8111265034"' },
            { id: 22, group: 'order', field: 'orderCode', level: 'root', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: 'BT-13', description: 'Order Code', examples: '"A 5094746384, A 8111265034"' },
            { id: 23, group: 'order', field: 'orderConfirmationNumber', level: 'root', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: '', description: 'Order Confirmation Number', examples: '"101303"' },
            { id: 24, group: 'order', field: 'ReferenceCode', level: 'root', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: '', description: 'ŒöœâŒ¥ŒπŒ∫œåœÇ ŒëŒΩŒ±œÜŒøœÅŒ¨œÇ|Reference Code', examples: '"Z60290075"' },
            { id: 25, group: 'order', field: 'lotNumber', level: 'root', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: '', description: 'ŒëœÅŒπŒ∏ŒºœåœÇ Œ†Œ±œÅœÑŒØŒ¥Œ±œÇ|Lot Number', examples: '"216848465"' },

            // Distribution Details
            { id: 26, group: 'distribution', field: 'DistributionDetails', level: 'root', mandatory: 'YES', type: 'object', length: '', mydata: '', ubl: '', description: 'Œ£œÑŒøŒπœáŒµŒØŒ± ŒîŒπŒ±Œ∫ŒØŒΩŒ∑œÉŒ∑œÇ|Distribution Details', examples: '{}' },
            { id: 27, group: 'distribution', field: 'InternalDocumentId', level: 'DistributionDetails', mandatory: 'YES', type: 'string', length: '100', mydata: '', ubl: '', description: 'Unique identification number for every INVOICE which is being filled by the company', examples: '"500094746385"' },
            { id: 28, group: 'distribution', field: 'additionalVehicleNumbers', level: 'DistributionDetails', mandatory: 'SPECIAL', type: 'string', length: '50', mydata: '', ubl: '', description: '2ŒøœÇ ŒëœÅŒπŒ∏ŒºœåœÇ ŒúŒµœÑŒ±œÜŒøœÅŒπŒ∫Œøœç ŒúŒ≠œÉŒøœÖ| ŒõŒøŒπœÄŒ≠œÇ ŒõŒµœÄœÑŒøŒºŒ≠œÅŒµŒπŒµœÇ ŒîŒπŒ±Œ∫ŒØŒΩŒ∑œÉŒ∑œÇ', examples: '""' },
            { id: 29, group: 'distribution', field: 'dispatchDate', level: 'DistributionDetails', mandatory: 'SPECIAL', type: 'string', length: '10', mydata: '', ubl: '', description: 'ŒóŒºŒµœÅŒøŒºŒ∑ŒΩŒØŒ± ŒàŒΩŒ±œÅŒæŒ∑œÇ ŒëœÄŒøœÉœÑŒøŒªŒÆœÇ|Distribution Start Date', examples: '"2025-12-14"' },
            { id: 30, group: 'distribution', field: 'dispatchTime', level: 'DistributionDetails', mandatory: 'SPECIAL', type: 'string', length: '19', mydata: '', ubl: '', description: 'ŒèœÅŒ± ŒàŒΩŒ±œÅŒæŒ∑œÇ ŒëœÄŒøœÉœÑŒøŒªŒÆœÇ|Distribution Start Time', examples: '"2025-12-14T23:27:23"' },
            { id: 31, group: 'distribution', field: 'vehileNumber', level: 'DistributionDetails', mandatory: 'SPECIAL', type: 'string', length: '20', mydata: '', ubl: '', description: 'ŒëœÅŒπŒ∏ŒºœåœÇ ŒúŒµœÑŒ±œÜŒøœÅŒπŒ∫Œøœç ŒúŒ≠œÉŒøœÖ|Vehicle Number', examples: '"TKN8080"' },
            { id: 32, group: 'distribution', field: 'movePurposeCode', level: 'DistributionDetails', mandatory: 'SPECIAL', type: 'number', length: '2', mydata: '', ubl: '', description: 'Œ£Œ∫ŒøœÄœåœÇ ŒîŒπŒ±Œ∫ŒØŒΩŒ∑œÉŒ∑œÇ|Distribution Purpose', examples: '1' },
            { id: 33, group: 'distribution', field: 'movePurpose', level: 'DistributionDetails', mandatory: 'SPECIAL', type: 'string', length: '100', mydata: '', ubl: '', description: 'Œ†ŒµœÅŒπŒ≥œÅŒ±œÜŒÆ Œ£Œ∫ŒøœÄœåœÇ ŒîŒπŒ±Œ∫ŒØŒΩŒ∑œÉŒ∑œÇ|Description Distribution Purpose', examples: '"Œ†œéŒªŒ∑œÉŒ∑/Sale"' },
            { id: 34, group: 'distribution', field: 'salesman', level: 'DistributionDetails', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: '', description: 'Œ†œâŒªŒ∑œÑŒÆœÇ|Salesman', examples: '""' },

            // Issuer
            { id: 35, group: 'issuer', field: 'Issuer', level: 'root', mandatory: 'YES', type: 'object', length: '', mydata: '', ubl: '', description: 'ŒïŒ∫Œ¥œåœÑŒ∑œÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Issuer', examples: '{}' },
            { id: 36, group: 'issuer', field: 'RegisteredName', level: 'Issuer', mandatory: 'YES', type: 'string', length: '200', mydata: '', ubl: 'BT-27', description: 'ŒïœÄœâŒΩœÖŒºŒØŒ± ŒïŒ∫Œ¥œåœÑŒ∑|Issuer Registered Name', examples: '"LMC Demo Company"' },
            { id: 37, group: 'issuer', field: 'BrandName', level: 'Issuer', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: '', description: 'ŒïŒºœÄŒøœÅŒπŒ∫ŒÆ ŒïœÄœâŒΩœÖŒºŒØŒ±|Brand Name', examples: '"LMC"' },
            { id: 38, group: 'issuer', field: 'Code', level: 'Issuer', mandatory: 'NO', type: 'string', length: '20', mydata: '', ubl: '', description: 'ŒöœâŒ¥ŒπŒ∫œåœÇ ŒïœÑŒ±ŒπœÅŒµŒØŒ±œÇ|Corporate Code', examples: '"3750"' },
            { id: 39, group: 'issuer', field: 'Vat', level: 'Issuer', mandatory: 'YES', type: 'string', length: '20', mydata: '', ubl: 'BT-31', description: 'ŒëŒ¶Œú ŒïŒ∫Œ¥œåœÑŒ∑ | Company\'s VAT', examples: '"EL110099934"' },
            { id: 40, group: 'issuer', field: 'TaxOffice', level: 'Issuer', mandatory: 'NO', type: 'string', length: '100', mydata: '', ubl: '', description: 'Œî.Œü.Œ•. ŒïŒ∫Œ¥œåœÑŒ∑|Tax Office', examples: '"Œ¶ŒëŒï ŒëŒòŒóŒùŒ©Œù"' },
            { id: 41, group: 'issuer', field: 'activities', level: 'Issuer', mandatory: 'NO', type: 'array', length: '', mydata: '', ubl: '', description: 'ŒîœÅŒ±œÉœÑŒ∑œÅŒπœåœÑŒ∑œÑŒµœÇ|Activities', examples: '["ŒïŒúŒ†ŒüŒ°ŒôŒöŒó ŒïŒ§ŒëŒôŒ°ŒïŒôŒë"]' },

            // Counterparty
            { id: 42, group: 'counterparty', field: 'counterParty', level: 'root', mandatory: 'YES', type: 'object', length: '', mydata: '', ubl: '', description: 'ŒõŒÆœÄœÑŒ∑œÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Recipient', examples: '{}' },
            { id: 43, group: 'counterparty', field: 'Code', level: 'counterParty', mandatory: 'NO', type: 'string', length: '50', mydata: '', ubl: '', description: 'Customer\'s Code', examples: '"30-00-0100"' },
            { id: 44, group: 'counterparty', field: 'registeredName', level: 'counterParty', mandatory: 'YES', type: 'string', length: '200', mydata: '', ubl: 'BT-44', description: 'ŒïœÄœâŒΩœÖŒºŒØŒ± ŒõŒÆœÄœÑŒ∑|Buyer Name', examples: '"Œ§ŒïŒ£Œ§ Œ†ŒïŒõŒëŒ§ŒóŒ£"' },
            { id: 45, group: 'counterparty', field: 'Vat', level: 'counterParty', mandatory: 'YES', type: 'string', length: '20', mydata: '', ubl: 'BT-48', description: 'ŒëŒ¶Œú ŒõŒÆœÄœÑŒ∑|Buyer VAT', examples: '"EL800654765"' },

            // Payment Details
            { id: 46, group: 'payment', field: 'PaymentDetails', level: 'root', mandatory: 'YES', type: 'object', length: '', mydata: '', ubl: '', description: 'Œ§œÅœåœÄŒøŒπ Œ†ŒªŒ∑œÅœâŒºŒÆœÇ|Payment Methods', examples: '{}' },
            { id: 47, group: 'payment', field: 'paymentDate', level: 'PaymentDetails', mandatory: 'NO', type: 'string', length: '10', mydata: '', ubl: 'BT-9', description: 'ŒóŒºŒµœÅŒøŒºŒ∑ŒΩŒØŒ± Œ†ŒªŒ∑œÅœâŒºŒÆœÇ|Payment Date', examples: '"2025-12-14"' },
            { id: 48, group: 'payment', field: 'exchangeCurrencyRate', level: 'PaymentDetails', mandatory: 'SPECIAL', type: 'number', length: '10', mydata: '', ubl: '', description: 'ŒôœÉŒøœÑŒπŒºŒØŒ±|Currency rate', examples: '1.00000' },
            { id: 49, group: 'payment', field: 'PaymentMethods', level: 'PaymentDetails', mandatory: 'YES', type: 'array', length: '', mydata: '', ubl: '', description: 'ŒúŒ≠Œ∏ŒøŒ¥ŒøŒπ Œ†ŒªŒ∑œÅœâŒºŒÆœÇ|Payment Methods Array', examples: '[{}]' },
            { id: 50, group: 'payment', field: 'paymentMethodTypeCode', level: 'PaymentMethods', mandatory: 'YES', type: 'number', length: '2', mydata: '', ubl: 'BT-81', description: 'Œ§œçœÄŒøœÇ Œ†ŒªŒ∑œÅœâŒºŒÆœÇ|Payment Method Type Code', examples: '5' },
            { id: 51, group: 'payment', field: 'amount', level: 'PaymentMethods', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-115', description: 'Œ†ŒøœÉœå Œ†ŒªŒ∑œÅœâŒºŒÆœÇ|Payment Amount', examples: '334.83' },

            // Additional Details
            { id: 52, group: 'additional', field: 'additionalDetails', level: 'root', mandatory: 'YES', type: 'object', length: '', mydata: '', ubl: '', description: 'Œ†œÅœåœÉŒ∏ŒµœÑŒµœÇ ŒõŒµœÄœÑŒøŒºŒ≠œÅŒµŒπŒµœÇ|Additional Details', examples: '{}' },
            { id: 53, group: 'additional', field: 'transmissionMethod', level: 'additionalDetails', mandatory: 'YES', type: 'string', length: '1', mydata: '', ubl: '', description: 'ŒúŒ≠Œ∏ŒøŒ¥ŒøœÇ ŒëœÄŒøœÉœÑŒøŒªŒÆœÇ|Transmission Method', examples: '"A"' },
            { id: 54, group: 'additional', field: 'avoidEmailGrouping', level: 'additionalDetails', mandatory: 'YES', type: 'boolean', length: '', mydata: '', ubl: '', description: 'ŒëœÄŒøœÜœÖŒ≥ŒÆ ŒüŒºŒ±Œ¥ŒøœÄŒøŒØŒ∑œÉŒ∑œÇ Email|Avoid Email Grouping', examples: 'false' },

            // Details (Lines)
            { id: 55, group: 'details', field: 'details', level: 'root', mandatory: 'YES', type: 'array', length: '', mydata: '', ubl: '', description: 'ŒìœÅŒ±ŒºŒºŒ≠œÇ Œ†Œ±œÅŒ±œÉœÑŒ±œÑŒπŒ∫Œøœç|Invoice Lines', examples: '[{}]' },
            { id: 56, group: 'details', field: 'lineNo', level: 'details', mandatory: 'YES', type: 'number', length: '5', mydata: '', ubl: 'BT-126', description: 'ŒëŒë Œ≥œÅŒ±ŒºŒºŒÆœÇ|Line Number', examples: '1' },
            { id: 57, group: 'details', field: 'RecordTypeCode', level: 'details', mandatory: 'YES', type: 'number', length: '1', mydata: '', ubl: '', description: 'ŒïŒØŒ¥ŒøœÇ ŒìœÅŒ±ŒºŒºŒÆœÇ|Record Type', examples: '0' },
            { id: 58, group: 'details', field: 'quantity', level: 'details', mandatory: 'SPECIAL', type: 'number', length: '15', mydata: '', ubl: 'BT-129', description: 'Œ†ŒøœÉœåœÑŒ∑œÑŒ±|Quantity', examples: '1.00000' },
            { id: 59, group: 'details', field: 'code', level: 'details', mandatory: 'NO', type: 'string', length: '50', mydata: '', ubl: 'BT-155', description: 'ŒöœâŒ¥ŒπŒ∫œåœÇ ŒïŒØŒ¥ŒøœÖœÇ|Line\'s Code', examples: '"251320104"' },
            { id: 60, group: 'details', field: 'descriptions', level: 'details', mandatory: 'YES', type: 'array', length: '', mydata: '', ubl: 'BT-153', description: 'Œ†ŒµœÅŒπŒ≥œÅŒ±œÜŒÆ ŒïŒØŒ¥ŒøœÖœÇ|Item Description', examples: '["ITEM 1"]' },
            { id: 61, group: 'details', field: 'UnitPrice', level: 'details', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-146', description: 'Œ§ŒπŒºŒÆ ŒúŒøŒΩŒ¨Œ¥Œ±œÇ|Unit Price', examples: '18.45' },
            { id: 62, group: 'details', field: 'netTotal', level: 'details', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-131', description: 'Line\'s totalNetAmount', examples: '52.76' },
            { id: 63, group: 'details', field: 'vatTotal', level: 'details', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-117', description: 'Line\'s totalVATAmount', examples: '3.16' },
            { id: 64, group: 'details', field: 'total', level: 'details', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-131', description: 'Line\'s totalGrossValue', examples: '55.92' },
            { id: 65, group: 'details', field: 'vatCategory', level: 'details', mandatory: 'YES', type: 'string', length: '10', mydata: '', ubl: 'BT-118', description: 'ŒöŒ±œÑŒ∑Œ≥ŒøœÅŒØŒ± Œ¶Œ†Œë|VAT Category', examples: '"6%"' },
            { id: 66, group: 'details', field: 'vatCategoryCode', level: 'details', mandatory: 'YES', type: 'number', length: '2', mydata: '', ubl: 'BT-118', description: 'TAX CATEGORY', examples: '3' },

            // Summaries
            { id: 67, group: 'summaries', field: 'summaries', level: 'root', mandatory: 'YES', type: 'object', length: '', mydata: '', ubl: '', description: 'Œ†ŒµœÅŒØŒªŒ∑œàŒ∑|Invoice Summary', examples: '{}' },
            { id: 68, group: 'summaries', field: 'totalNetAmount', level: 'summaries', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-106', description: 'Total Net Amount of the Invoice', examples: '315.88' },
            { id: 69, group: 'summaries', field: 'totalVATAmount', level: 'summaries', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-110', description: 'Total VAT Amount of the Invoice', examples: '18.95' },
            { id: 70, group: 'summaries', field: 'totalGrossValue', level: 'summaries', mandatory: 'YES', type: 'number', length: '15', mydata: '', ubl: 'BT-112', description: 'Total Gross Amount of the Invoice', examples: '334.83' },

            // VAT Analysis
            { id: 71, group: 'vat', field: 'vatAnalysis', level: 'root', mandatory: 'YES', type: 'array', length: '', mydata: '', ubl: '', description: 'ŒëŒΩŒ¨ŒªœÖœÉŒ∑ Œ¶Œ†Œë|VAT Analysis', examples: '[{}]' },
            { id: 72, group: 'vat', field: 'name', level: 'vatAnalysis', mandatory: 'YES', type: 'string', length: '10', mydata: '', ubl: '', description: 'Description of the Percentage of the VAT', examples: '"6%"' },
            { id: 73, group: 'vat', field: 'percentage', level: 'vatAnalysis', mandatory: 'YES', type: 'number', length: '5', mydata: '', ubl: '', description: 'Number of the percentage of the VAT', examples: '6' },

            // Banks
            { id: 74, group: 'banks', field: 'banks', level: 'root', mandatory: 'NO', type: 'array', length: '', mydata: '', ubl: '', description: 'Associated Banks', examples: '[{}]' },
            { id: 75, group: 'banks', field: 'bicCode', level: 'banks', mandatory: 'NO', type: 'string', length: '11', mydata: '', ubl: 'BT-84', description: 'BIC Code', examples: '"CITIGRAA"' },
            { id: 76, group: 'banks', field: 'iban', level: 'banks', mandatory: 'NO', type: 'string', length: '34', mydata: '', ubl: 'BT-84', description: 'IBAN', examples: '"GR92 0000 0000 0000 0000 0000 000"' }
        ];

        let editingId = null;
        let nextId = 3;

        const sampleJson = `{
  "series": "Œö",
  "number": "000002",
  "dateIssued": "2024-07-17T23:27:23",
  "invoiceTypeCode": "1.1",
  "Issuer": {
    "RegisteredName": "LMC Demo Company",
    "Vat": "EL110099934",
    "Address": {
      "CountryCode": "GR",
      "City": "ŒëŒòŒóŒùŒë",
      "Street": "Œõ.ŒúŒïŒ£ŒüŒìŒïŒôŒ©Œù 243",
      "Postal": "15451"
    }
  },
  "counterParty": {
    "registeredName": "Œ§ŒïŒ£Œ§ Œ†ŒïŒõŒëŒ§ŒóŒ£",
    "Vat": "EL800654765",
    "address": {
      "countryCode": "GR",
      "city": "ŒëŒòŒóŒùŒë",
      "Street": "ŒõŒïŒ©Œ¶ŒüŒ°ŒüŒ£ ŒúŒïŒ£ŒüŒìŒïŒôŒ©Œù 300"
    }
  },
  "details": [
    {
      "lineNo": 1,
      "quantity": 1.00000,
      "UnitPrice": 18.45,
      "descriptions": ["ITEM 1"]
    }
  ]
}`;

        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));

            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));

            // Show selected tab content
            document.getElementById(tabName).classList.add('active');

            // Add active class to clicked tab
            event.target.classList.add('active');

            // Refresh content if needed
            if (tabName === 'preview') {
                generateDocumentation();
            }
        }

        // Add new field
        function addNewField() {
            const group = document.getElementById('newGroup').value;
            const field = document.getElementById('newField').value;
            const mandatory = document.getElementById('newMandatory').value;
            const type = document.getElementById('newType').value;
            const length = document.getElementById('newLength').value;
            const mydata = document.getElementById('newMydata').value;
            const ubl = document.getElementById('newUbl').value;
            const description = document.getElementById('newDescription').value;
            const examples = document.getElementById('newExamples').value;

            if (!field || !description) {
                alert('Œ†Œ±œÅŒ±Œ∫Œ±Œªœé œÉœÖŒºœÄŒªŒ∑œÅœéœÉœÑŒµ œÑŒøœÖŒªŒ¨œáŒπœÉœÑŒøŒΩ œÑŒø JSON Field Œ∫Œ±Œπ œÑŒø Description');
                return;
            }

            const newField = {
                id: nextId++,
                group,
                field,
                level: 'root',
                mandatory,
                type,
                length,
                mydata,
                ubl,
                description,
                examples
            };

            schemaFields.push(newField);
            clearNewFieldForm();
            renderFieldsTable();
        }

        // Clear form
        function clearNewFieldForm() {
            document.getElementById('newGroup').value = '';
            document.getElementById('newField').value = '';
            document.getElementById('newMandatory').value = 'YES';
            document.getElementById('newType').value = 'string';
            document.getElementById('newLength').value = '';
            document.getElementById('newMydata').value = '';
            document.getElementById('newUbl').value = '';
            document.getElementById('newDescription').value = '';
            document.getElementById('newExamples').value = '';
        }

        // Render fields table
        function renderFieldsTable() {
            const tbody = document.getElementById('fieldsTableBody');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            const filteredFields = schemaFields.filter(field =>
                field.field.toLowerCase().includes(searchTerm) ||
                field.group.toLowerCase().includes(searchTerm) ||
                field.description.toLowerCase().includes(searchTerm)
            );

            tbody.innerHTML = '';

            filteredFields.forEach(field => {
                const row = document.createElement('tr');
                
                if (editingId === field.id) {
                    row.className = 'edit-row';
                    row.innerHTML = `
                        <td><input type="text" value="${field.group}" id="edit-group-${field.id}"></td>
                        <td><input type="text" value="${field.field}" id="edit-field-${field.id}"></td>
                        <td><input type="text" value="${field.level}" id="edit-level-${field.id}"></td>
                        <td>
                            <select id="edit-mandatory-${field.id}">
                                <option value="YES" ${field.mandatory === 'YES' ? 'selected' : ''}>‚úÖ YES</option>
                                <option value="NO" ${field.mandatory === 'NO' ? 'selected' : ''}>üü° NO</option>
                                <option value="SPECIAL" ${field.mandatory === 'SPECIAL' ? 'selected' : ''}>‚ö†Ô∏è SPECIAL</option>
                            </select>
                        </td>
                        <td>
                            <select id="edit-type-${field.id}">
                                <option value="string" ${field.type === 'string' ? 'selected' : ''}>string</option>
                                <option value="number" ${field.type === 'number' ? 'selected' : ''}>number</option>
                                <option value="boolean" ${field.type === 'boolean' ? 'selected' : ''}>boolean</option>
                                <option value="object" ${field.type === 'object' ? 'selected' : ''}>object</option>
                                <option value="array" ${field.type === 'array' ? 'selected' : ''}>array</option>
                            </select>
                        </td>
                        <td><input type="text" value="${field.length}" id="edit-length-${field.id}"></td>
                        <td><input type="text" value="${field.mydata}" id="edit-mydata-${field.id}"></td>
                        <td><input type="text" value="${field.ubl}" id="edit-ubl-${field.id}"></td>
                        <td><input type="text" value="${field.description}" id="edit-description-${field.id}"></td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-success" onclick="saveEdit(${field.id})">üíæ</button>
                                <button class="btn" onclick="cancelEdit()">‚ùå</button>
                            </div>
                        </td>
                    `;
                } else {
                    const mandatoryBadge = field.mandatory === 'YES' ? 
                        '<span class="badge badge-green">‚úÖ YES</span>' :
                        field.mandatory === 'NO' ?
                        '<span class="badge badge-yellow">üü° NO</span>' :
                        '<span class="badge badge-orange">‚ö†Ô∏è SPECIAL</span>';

                    row.innerHTML = `
                        <td>${field.group}</td>
                        <td class="field-code">${field.field}</td>
                        <td>${field.level}</td>
                        <td>${mandatoryBadge}</td>
                        <td><span class="code">${field.type}</span></td>
                        <td>${field.length}</td>
                        <td class="mydata-code">${field.mydata}</td>
                        <td>${field.ubl}</td>
                        <td style="max-width: 200px; overflow: hidden; text-overflow: ellipsis;" title="${field.description}">${field.description}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-primary" onclick="startEdit(${field.id})">‚úèÔ∏è</button>
                                <button class="btn btn-danger" onclick="deleteField(${field.id})">üóëÔ∏è</button>
                            </div>
                        </td>
                    `;
                }
                
                tbody.appendChild(row);
            });
        }

        // Edit functions
        function startEdit(id) {
            editingId = id;
            renderFieldsTable();
        }

        function saveEdit(id) {
            const field = schemaFields.find(f => f.id === id);
            field.group = document.getElementById(`edit-group-${id}`).value;
            field.field = document.getElementById(`edit-field-${id}`).value;
            field.level = document.getElementById(`edit-level-${id}`).value;
            field.mandatory = document.getElementById(`edit-mandatory-${id}`).value;
            field.type = document.getElementById(`edit-type-${id}`).value;
            field.length = document.getElementById(`edit-length-${id}`).value;
            field.mydata = document.getElementById(`edit-mydata-${id}`).value;
            field.ubl = document.getElementById(`edit-ubl-${id}`).value;
            field.description = document.getElementById(`edit-description-${id}`).value;
            
            editingId = null;
            renderFieldsTable();
        }

        function cancelEdit() {
            editingId = null;
            renderFieldsTable();
        }

        function deleteField(id) {
            if (confirm('ŒïŒØœÉœÑŒµ œÉŒØŒ≥ŒøœÖœÅŒøŒπ œåœÑŒπ Œ∏Œ≠ŒªŒµœÑŒµ ŒΩŒ± Œ¥ŒπŒ±Œ≥œÅŒ¨œàŒµœÑŒµ Œ±œÖœÑœå œÑŒø field;')) {
                schemaFields = schemaFields.filter(f => f.id !== id);
                renderFieldsTable();
            }
        }

        // Filter fields
        function filterFields() {
            renderFieldsTable();
        }

        // JSON processing
        function generateComments() {
            const inputJson = document.getElementById('inputJson').value;
            if (!inputJson.trim()) {
                document.getElementById('outputJsonc').textContent = '';
                return;
            }

            try {
                const parsed = JSON.parse(inputJson);
                const commented = addCommentsToJson(parsed, '', 0);
                document.getElementById('outputJsonc').textContent = commented;
            } catch (error) {
                document.getElementById('outputJsonc').textContent = 'JSON Error: ' + error.message;
            }
        }

        function addCommentsToJson(obj, path = '', level = 0) {
            const indent = '  '.repeat(level);
            const nextIndent = '  '.repeat(level + 1);
            
            if (Array.isArray(obj)) {
                let result = '[\n';
                obj.forEach((item, index) => {
                    result += nextIndent + addCommentsToJson(item, `${path}[${index}]`, level + 1);
                    if (index < obj.length - 1) result += ',';
                    result += '\n';
                });
                result += indent + ']';
                return result;
            }
            
            if (typeof obj === 'object' && obj !== null) {
                let result = '{\n';
                const keys = Object.keys(obj);
                
                keys.forEach((key, index) => {
                    const currentPath = path ? `${path}.${key}` : key;
                    const fieldInfo = findFieldInfo(key, currentPath);
                    
                    // Add comment for this field
                    if (fieldInfo) {
                        const mandatoryIcon = fieldInfo.mandatory === 'YES' ? '‚úÖ' : 
                                           fieldInfo.mandatory === 'NO' ? 'üü°' : '‚ö†Ô∏è';
                        result += nextIndent + `// ${mandatoryIcon} ${fieldInfo.description}\n`;
                        if (fieldInfo.length) {
                            result += nextIndent + `// Length: ${fieldInfo.length}\n`;
                        }
                        if (fieldInfo.mydata) {
                            result += nextIndent + `// MyData: ${fieldInfo.mydata}\n`;
                        }
                        if (fieldInfo.ubl) {
                            result += nextIndent + `// UBL: ${fieldInfo.ubl}\n`;
                        }
                        if (fieldInfo.examples) {
                            result += nextIndent + `// Example: ${fieldInfo.examples}\n`;
                        }
                    }
                    
                    result += nextIndent + `"${key}": ${addCommentsToJson(obj[key], currentPath, level + 1)}`;
                    if (index < keys.length - 1) result += ',';
                    result += '\n';
                });
                
                result += indent + '}';
                return result;
            }
            
            // Primitive values
            return JSON.stringify(obj);
        }

        function findFieldInfo(fieldName, fullPath) {
            // Try exact field match first
            let found = schemaFields.find(f => f.field === fieldName);
            
            // If not found, try partial path matching
            if (!found) {
                found = schemaFields.find(f => {
                    const pathParts = fullPath.split('.');
                    return pathParts.includes(f.field) || f.field.includes(fieldName);
                });
            }
            
            return found;
        }

        function loadSampleData() {
            document.getElementById('inputJson').value = sampleJson;
            generateComments();
        }

        function copyOutput() {
            const output = document.getElementById('outputJsonc').textContent;
            navigator.clipboard.writeText(output).then(() => {
                alert('Copied to clipboard!');
            });
        }

        function downloadCommentedJson() {
            const output = document.getElementById('outputJsonc').textContent;
            const blob = new Blob([output], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'commented-schema.jsonc';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Export schema
        function exportSchema() {
            const blob = new Blob([JSON.stringify(schemaFields, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schema-documentation.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Generate documentation
        function generateDocumentation() {
            const content = document.getElementById('documentationContent');
            const groups = [...new Set(schemaFields.map(f => f.group))];
            
            let html = '<h2>API Schema Documentation</h2><p>Automatically generated from schema definition.</p>';
            
            groups.forEach(group => {
                if (!group) return;
                
                html += `
                    <div style="margin-bottom: 32px;">
                        <h3 style="text-transform: capitalize; font-weight: 600; font-size: 18px; border-bottom: 1px solid #e5e7eb; padding-bottom: 8px;">${group}</h3>
                        <div style="margin-top: 16px; overflow-x: auto;">
                            <table class="table" style="font-size: 14px;">
                                <thead style="background-color: #f3f4f6;">
                                    <tr>
                                        <th style="padding: 8px;">JSON Field</th>
                                        <th style="padding: 8px;">Required</th>
                                        <th style="padding: 8px;">Type</th>
                                        <th style="padding: 8px;">Length</th>
                                        <th style="padding: 8px;">MyData</th>
                                        <th style="padding: 8px;">UBL</th>
                                        <th style="padding: 8px;">Description</th>
                                        <th style="padding: 8px;">Example</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;
                
                schemaFields.filter(f => f.group === group).forEach(field => {
                    const requiredIcon = field.mandatory === 'YES' ? '‚úÖ' : 
                                       field.mandatory === 'NO' ? 'üü°' : '‚ö†Ô∏è';
                    
                    html += `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 8px;" class="field-code">${field.field}</td>
                            <td style="padding: 8px;">${requiredIcon}</td>
                            <td style="padding: 8px;"><span class="code">${field.type}</span></td>
                            <td style="padding: 8px;">${field.length || ''}</td>
                            <td style="padding: 8px;" class="mydata-code">${field.mydata || ''}</td>
                            <td style="padding: 8px;">${field.ubl || ''}</td>
                            <td style="padding: 8px;">${field.description}</td>
                            <td style="padding: 8px;" class="example-code">${field.examples || ''}</td>
                        </tr>
                    `;
                });
                
                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        // Export functions
        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('l', 'mm', 'a4'); // landscape orientation
            
            // Add title
            doc.setFontSize(20);
            doc.text('JSON Schema Documentation', 20, 20);
            
            // Add generation date
            doc.setFontSize(10);
            doc.text(`Generated on: ${new Date().toLocaleDateString('el-GR')}`, 20, 30);
            
            let currentY = 45;
            const groups = [...new Set(schemaFields.map(f => f.group))];
            
            groups.forEach((group, groupIndex) => {
                if (!group) return;
                
                const groupFields = schemaFields.filter(f => f.group === group);
                
                // Add group title
                doc.setFontSize(14);
                doc.setFont(undefined, 'bold');
                doc.text(group.toUpperCase(), 20, currentY);
                currentY += 10;
                
                // Prepare table data
                const tableData = groupFields.map(field => [
                    field.field,
                    field.mandatory === 'YES' ? 'Mandatory' : field.mandatory === 'NO' ? 'Optional' : 'Special',
                    field.type,
                    field.length || '',
                    field.mydata || '',
                    field.ubl || '',
                    field.description,
                    field.examples || ''
                ]);
                
                // Add table
                doc.autoTable({
                    startY: currentY,
                    head: [['JSON Field', 'Required', 'Type', 'Length', 'MyData', 'UBL', 'Description', 'Example']],
                    body: tableData,
                    styles: {
                        fontSize: 8,
                        cellPadding: 2,
                    },
                    headStyles: {
                        fillColor: [64, 64, 64],
                        textColor: [255, 255, 255],
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    },
                    columnStyles: {
                        0: { fontStyle: 'bold', textColor: [37, 99, 235] }, // JSON Field
                        4: { fontStyle: 'bold', textColor: [124, 58, 237] }, // MyData
                        7: { fontStyle: 'bold', textColor: [5, 150, 105] }   // Example
                    },
                    margin: { left: 20, right: 20 },
                    pageBreak: 'auto',
                });
                
                currentY = doc.lastAutoTable.finalY + 15;
                
                // Add new page if needed for next group
                if (groupIndex < groups.length - 1 && currentY > 180) {
                    doc.addPage();
                    currentY = 20;
                }
            });
            
            // Save the PDF
            doc.save('schema-documentation.pdf');
        }

        function exportToExcel() {
            // Create a new workbook
            const wb = XLSX.utils.book_new();
            
            // Create overview sheet with all data
            const allData = [
                ['Group', 'JSON Field', 'Level', 'Required', 'Type', 'Length', 'MyData', 'UBL', 'Description', 'Example']
            ];
            
            schemaFields.forEach(field => {
                allData.push([
                    field.group,
                    field.field,
                    field.level,
                    field.mandatory === 'YES' ? 'Mandatory' : field.mandatory === 'NO' ? 'Optional' : 'Special',
                    field.type,
                    field.length || '',
                    field.mydata || '',
                    field.ubl || '',
                    field.description,
                    field.examples || ''
                ]);
            });
            
            const ws_overview = XLSX.utils.aoa_to_sheet(allData);
            
            // Set column widths
            const colWidths = [
                { wch: 15 }, // Group
                { wch: 20 }, // JSON Field
                { wch: 10 }, // Level
                { wch: 12 }, // Required
                { wch: 10 }, // Type
                { wch: 10 }, // Length
                { wch: 15 }, // MyData
                { wch: 15 }, // UBL
                { wch: 40 }, // Description
                { wch: 20 }  // Example
            ];
            ws_overview['!cols'] = colWidths;
            
            // Add overview sheet
            XLSX.utils.book_append_sheet(wb, ws_overview, 'Overview');
            
            // Create separate sheets for each group
            const groups = [...new Set(schemaFields.map(f => f.group))];
            
            groups.forEach(group => {
                if (!group) return;
                
                const groupFields = schemaFields.filter(f => f.group === group);
                const groupData = [
                    ['JSON Field', 'Required', 'Type', 'Length', 'MyData', 'UBL', 'Description', 'Example']
                ];
                
                groupFields.forEach(field => {
                    groupData.push([
                        field.field,
                        field.mandatory === 'YES' ? 'Mandatory' : field.mandatory === 'NO' ? 'Optional' : 'Special',
                        field.type,
                        field.length || '',
                        field.mydata || '',
                        field.ubl || '',
                        field.description,
                        field.examples || ''
                    ]);
                });
                
                const ws_group = XLSX.utils.aoa_to_sheet(groupData);
                
                // Set column widths for group sheets
                const groupColWidths = [
                    { wch: 20 }, // JSON Field
                    { wch: 12 }, // Required
                    { wch: 10 }, // Type
                    { wch: 10 }, // Length
                    { wch: 15 }, // MyData
                    { wch: 15 }, // UBL
                    { wch: 40 }, // Description
                    { wch: 20 }  // Example
                ];
                ws_group['!cols'] = groupColWidths;
                
                // Sanitize sheet name (Excel has limitations)
                const sheetName = group.replace(/[\\\/\?\*\[\]]/g, '_').substring(0, 31);
                XLSX.utils.book_append_sheet(wb, ws_group, sheetName);
            });
            
            // Save the Excel file
            XLSX.writeFile(wb, 'schema-documentation.xlsx');
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            renderFieldsTable();
            generateDocumentation();
        });
    </script>
</body>
</html>
